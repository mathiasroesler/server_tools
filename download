#!/bin/bash

source server_functions

function print_usage() {
	# Prints function usage.
	#
	# Arguments:
	# Return:
	#
	printf "Usage: download [-hr] [-p number] [-s number] file\n"
	printf "Copy file from remote server to current working directory or multiple files from remote server to current working directory.\n"
	printf "Options:\n"
	printf " -h, print help.\n"
	printf " -r, download a folder.\n"
	printf " -p number, specify port number.\n"
	printf " -s number, select the desired server.\n"
	available_servers

return 0
}



RECURSIVE=false
PORT=false
port_number=22
server=NULL

# Parse options
while getopts ":rhp:s:" opt; do
	case $opt in
		r) 
			RECURSIVE='true' 
			;;
		h) 
			print_usage
			exit 
			;;
		P)
			port_number=${OPTARG}
			PORT=true
		       	;;
		s)
			set_connection_params ${OPTARG}
			;;
		?)
			echo "download: invalid option."
			echo "Try 'download -h' for help."
			exit
			;;
	esac
done

if [[ $server == NULL ]]; then
	echo "download: no server selected."
	echo "Try 'download -h' for help."
	exit
fi

if [[ $# -lt 1 ]]; then
	echo "download: not enough arguments."
	echo "Try 'download -h' for help."
	exit
fi

# Shift to first argument after options
shift $(($OPTIND - 1))

ARGS="$@"
destination=$PWD
files=${ARGS}

if [[ $RECURSIVE == 'true' ]]; then
	print_info
	scp -rP $port_number $options $server:$files $destination

else
	print_info
 	scp -P $port_number $options $server:$files $destination
fi

