#!/bin/bash

source server_functions

function print_usage() {
	# Prints function usage.
	#
	# Arguments:
	# Return:
	#
	printf "Usage: $NAME [-hr] [-p number] server file ... destination\n"
	printf "Copy file to remote server destination or multiple files "
	printf "to remote server destination. There are $NB_SERVERS available "
	printf "servers: \n"
	available_servers
	printf "Options:\n"
	printf " -h, print help.\n"
	printf " -r, copies directories recursively.\n"
	printf " -p number, specify port number.\n"

return 0
}


RECURSIVE=false
PORT=false
port_number=22
server=NULL


# Parse options
while getopts ":rhp:s:" opt; do
	case $opt in
		r) 
			RECURSIVE='true' 
			;;
		h) 
			print_usage
			exit 
			;;
		p)
			port_number="${OPTARG}"
			PORT=true
		       	;;

		?)
			error_handler "invalid option."
			;;
	esac
done


# Shift to first argument after options.
shift $(($OPTIND - 1))

argument_nb_check $# 3

set_connection_params $1; shift

ARGS="$@"
destination=${@: -1}
files=${ARGS%${destination}}

if [[ $RECURSIVE == 'true' ]]; then
	print_info
	scp -rP $port_number $files $options $server:$destination

else
	print_info
	scp -P $port_number $files $options $server:$destination
fi

